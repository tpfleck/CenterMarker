name: Release on tag

on:
  push:
    tags:
      - 'alpha-*' # match alpha tags; change to '*' to match all tags

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create release ZIP
        run: |
          mkdir -p dist package/CenterMarker
          # Copy repository files into a package/CenterMarker folder so the zip root contains CenterMarker/
          rsync -a --exclude='.git' --exclude='.github' --exclude='dist' --exclude='*.zip' ./ package/CenterMarker/
          pushd package
          zip -r "../dist/CenterMarker-${{ github.ref_name }}.zip" CenterMarker
          popd

      - name: Create SHA256 checksum for ZIP
        run: |
          sha256sum "dist/CenterMarker-${{ github.ref_name }}.zip" | awk '{print $1}' > "dist/CenterMarker-${{ github.ref_name }}.zip.sha256"

      - name: Create GitHub Release and upload assets
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ github.ref_name }}
          files: |
            dist/*.zip
            dist/*.sha256
          draft: false
          prerelease: true
